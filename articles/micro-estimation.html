<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Micronuclei dose estimation • biodosetools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Nunito-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Micronuclei dose estimation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">biodosetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Dicentrics</h6></li>
    <li><a class="dropdown-item" href="../articles/dicent-fitting.html">Dicentrics dose-effect fitting</a></li>
    <li><a class="dropdown-item" href="../articles/dicent-estimation.html">Dicentrics dose estimation</a></li>
    <li><a class="dropdown-item" href="../articles/dicent-limits.html">Dicentrics characteristic limits</a></li>
    <li><a class="dropdown-item" href="../articles/dicent-mixed.html">Dicentrics dose estimation criticality accidents</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Translocations</h6></li>
    <li><a class="dropdown-item" href="../articles/trans-fitting.html">Translocations dose-effect fitting</a></li>
    <li><a class="dropdown-item" href="../articles/trans-estimation.html">Translocations dose estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Micronuclei</h6></li>
    <li><a class="dropdown-item" href="../articles/micro-fitting.html">Micronuclei dose-effect fitting</a></li>
    <li><a class="dropdown-item" href="../articles/micro-estimation.html">Micronuclei dose estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Interlaboratory comparisons</h6></li>
    <li><a class="dropdown-item" href="../articles/interlab.html">Interlaboratory comparison</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biodosetools-team/biodosetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Micronuclei dose estimation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biodosetools-team/biodosetools/blob/main/vignettes/micro-estimation.Rmd" class="external-link"><code>vignettes/micro-estimation.Rmd</code></a></small>
      <div class="d-none name"><code>micro-estimation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="load-pre-calculated-curve">Load pre-calculated curve<a class="anchor" aria-label="anchor" href="#load-pre-calculated-curve"></a>
</h2>
<p>The first step is to either load the pre-calculated curve in
<code>.rds</code> format obtained in the dose-effect fitting module or
input the curve coefficients manually in case the user wants to use a
pre-existing curve calculated outside of Biodose Tools. Clicking on
“Preview data” will load the curve into the app and display it on the
“Results” tabbed box. If coefficients are entered manually, a
irradiation conditions tab will appear to fill with corresponding
information.</p>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-estimate-01.png" alt="'Curve fitting data options' box and 'Results' tabbed box in the dose estimation module when loading curve from an `.rds` file." width="100%"><p class="caption">
‘Curve fitting data options’ box and ‘Results’ tabbed box in the dose
estimation module when loading curve from an <code>.rds</code> file.
</p>
</div>
<div class="figure">
<img src="figures/screenshot-micronuclei-estimate-02.png" alt="'Curve fitting data options' box and 'Results' tabbed box in the dose estimation module when inputting curve coefficients manually. Note that if no variance-covariance matrix is provided, only the variances calculated from the coefficients' standard errors will be used in calculations." width="100%"><p class="caption">
‘Curve fitting data options’ box and ‘Results’ tabbed box in the dose
estimation module when inputting curve coefficients manually. Note that
if no variance-covariance matrix is provided, only the variances
calculated from the coefficients’ standard errors will be used in
calculations.
</p>
</div>
<p>This step is accomplished in R by either using the results from
<code><a href="../reference/fit.html">fit()</a></code> or by loading an existing <code>.rds</code> object
via <code><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS()</a></code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"micronuclei-fitting-results.rds"</span>, package <span class="op">=</span> <span class="st">"biodosetools"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_results</span><span class="op">$</span><span class="va">fit_coeffs</span></span>
<span><span class="co">#&gt;                estimate    std.error statistic      p.value</span></span>
<span><span class="co">#&gt; coeff_C     0.022304968 0.0016412463 13.590263 2.747258e-06</span></span>
<span><span class="co">#&gt; coeff_alpha 0.027791344 0.0044014447  6.314141 3.987058e-04</span></span>
<span><span class="co">#&gt; coeff_beta  0.003332782 0.0009379284  3.553343 9.301982e-03</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="input-case-data">Input case data<a class="anchor" aria-label="anchor" href="#input-case-data"></a>
</h2>
<p>Next we can choose to either load the case data from a file
(supported formats are <code>.csv</code>, <code>.dat</code>, and
<code>.txt</code>) or to input the data manually. Once the table is
generated and filled, the “Calculate parameters” button will calculate
the total number of cells
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>),
total number of aberrations
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>),
as well as mean
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>y</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{y}</annotation></semantics></math>),
standard error
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>σ</mi><annotation encoding="application/x-tex">\sigma</annotation></semantics></math>),
dispersion index
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mi>/</mi><mover><mi>y</mi><mo accent="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\sigma^{2}/\bar{y}</annotation></semantics></math>),
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>-value.
An ID column will also appear to identify each case. Multiple cases are
supported.</p>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-estimate-03.png" alt="'Data input options' and 'Data input' boxes in the dose estimation module." width="100%"><p class="caption">
‘Data input options’ and ‘Data input’ boxes in the dose estimation
module.
</p>
</div>
<p>This step is accomplished in R by calling the
<code><a href="../reference/calculate_aberr_table.html">calculate_aberr_table()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  ID <span class="op">=</span> <span class="st">'Case1'</span>, C0 <span class="op">=</span> <span class="fl">302</span>, C1 <span class="op">=</span> <span class="fl">28</span>, C2 <span class="op">=</span> <span class="fl">22</span>, C3 <span class="op">=</span> <span class="fl">8</span>, C4 <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/calculate_aberr_table.html">calculate_aberr_table</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"case"</span>,</span>
<span>    assessment_u <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    aberr_module <span class="op">=</span> <span class="st">"micronuclei"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">case_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 12</span></span></span>
<span><span class="co">#&gt;   ID        N     X    C0    C1    C2    C3    C4     y  y_err    DI     u</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Case1   361   100   302    28    22     8     1 0.277 0.036<span style="text-decoration: underline;">8</span>  1.77  10.4</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="perform-dose-estimation">Perform dose estimation<a class="anchor" aria-label="anchor" href="#perform-dose-estimation"></a>
</h2>
<p>The final step is to select the dose estimation options. In the “Dose
estimation options” box we can select type of exposure (acute,
protracted, and highly protracted), type of assessment (whole-body,
partial-body, or heterogeneous), and error methods for each type of
assessment.</p>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-estimate-04.png" alt="'Dose estimation options' box in the dose estimation module." width="60%"><p class="caption">
‘Dose estimation options’ box in the dose estimation module.
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-estimate-05.png" alt="'Results' tabbed box, 'Curve plot' and 'Save results' boxes in the dose estimation module." width="100%"><p class="caption">
‘Results’ tabbed box, ‘Curve plot’ and ‘Save results’ boxes in the dose
estimation module.
</p>
</div>
<p>To perform the dose estimation in R we can call the adequate
<code>estimate_*()</code> functions. In this example, we will use
<code><a href="../reference/estimate_whole_body_merkle.html">estimate_whole_body_merkle()</a></code> and
<code><a href="../reference/estimate_partial_body_dolphin.html">estimate_partial_body_dolphin()</a></code>. First of all, however, we
will need to load the fit coefficients and variance-covariance
matrix:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_coeffs</span> <span class="op">&lt;-</span> <span class="va">fit_results</span><span class="op">[[</span><span class="st">"fit_coeffs"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">fit_var_cov_mat</span> <span class="op">&lt;-</span> <span class="va">fit_results</span><span class="op">[[</span><span class="st">"fit_var_cov_mat"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Since we have a protracted exposure, we need to calculate the value
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>G</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">G(x)</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">protracted_g_value</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/protracted_g_function.html">protracted_g_function</a></span><span class="op">(</span></span>
<span>  time <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  time_0 <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">protracted_g_value</span></span>
<span><span class="co">#&gt; [1] 0.9216251</span></span></code></pre></div>
<p>After that is done, we can simply call
<code><a href="../reference/estimate_whole_body_merkle.html">estimate_whole_body_merkle()</a></code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">results_whole_merkle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_whole_body_merkle.html">estimate_whole_body_merkle</a></span><span class="op">(</span></span>
<span>  num_cases <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">case_data</span>,</span>
<span>  <span class="va">fit_coeffs</span>,</span>
<span>  <span class="va">fit_var_cov_mat</span>,</span>
<span>  conf_int_yield <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  conf_int_curve <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  <span class="va">protracted_g_value</span>,</span>
<span>  aberr_module <span class="op">=</span> <span class="st">"micronuclei"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>To visualize the estimated doses, we call the
<code><a href="../reference/plot_estimated_dose_curve.html">plot_estimated_dose_curve()</a></code> function:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_estimated_dose_curve.html">plot_estimated_dose_curve</a></span><span class="op">(</span></span>
<span>  est_doses <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>whole <span class="op">=</span> <span class="va">results_whole_merkle</span><span class="op">)</span>,</span>
<span>  <span class="va">fit_coeffs</span>,</span>
<span>  <span class="va">fit_var_cov_mat</span>,</span>
<span>  protracted_g_value <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  conf_int_curve <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  aberr_name <span class="op">=</span> <span class="st">"Micronuclei"</span>,</span>
<span>  place <span class="op">=</span> <span class="st">"UI"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="micro-estimation_files/figure-html/micro-estimated-dose-curve-1.png" alt="Plot of estimated doses generated by \{biodosetools\}. The grey shading indicates the uncertainties associated with the calibration curve." width="576"><p class="caption">
Plot of estimated doses generated by {biodosetools}. The grey shading
indicates the uncertainties associated with the calibration curve.
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://aldomann.com" class="external-link">Alfredo Hernández</a>, <a href="https://portalrecerca.uab.cat/es/persons/anna-frances-abellan" class="external-link">Anna Frances-Abellan</a>, David Endesfelder, Pere Puig.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
