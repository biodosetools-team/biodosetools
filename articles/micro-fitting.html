<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Micronuclei dose-effect fitting • biodosetools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Nunito_Sans-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Fira_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Nunito-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Micronuclei dose-effect fitting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">biodosetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.6.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Dicentrics</h6></li>
    <li><a class="dropdown-item" href="../articles/dicent-fitting.html">Dicentrics dose-effect fitting</a></li>
    <li><a class="dropdown-item" href="../articles/dicent-estimation.html">Dicentrics dose estimation</a></li>
    <li><a class="dropdown-item" href="../articles/dicent-limits.html">Dicentrics characteristic limits</a></li>
    <li><a class="dropdown-item" href="../articles/dicent-mixed.html">Dicentrics dose estimation criticality accidents</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Translocations</h6></li>
    <li><a class="dropdown-item" href="../articles/trans-fitting.html">Translocations dose-effect fitting</a></li>
    <li><a class="dropdown-item" href="../articles/trans-estimation.html">Translocations dose estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Micronuclei</h6></li>
    <li><a class="dropdown-item" href="../articles/micro-fitting.html">Micronuclei dose-effect fitting</a></li>
    <li><a class="dropdown-item" href="../articles/micro-estimation.html">Micronuclei dose estimation</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Interlaboratory comparisons</h6></li>
    <li><a class="dropdown-item" href="../articles/interlab.html">Interlaboratory comparison</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/biodosetools-team/biodosetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Micronuclei dose-effect fitting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/biodosetools-team/biodosetools/blob/v3.6.2/vignettes/micro-fitting.Rmd" class="external-link"><code>vignettes/micro-fitting.Rmd</code></a></small>
      <div class="d-none name"><code>micro-fitting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="input-count-data">Input count data<a class="anchor" aria-label="anchor" href="#input-count-data"></a>
</h2>
<p>The first step is to input the count data. On the {shiny} app, we can
select to either load the count data from a file (supported formats are
<code>.csv</code>, <code>.dat</code>, and <code>.txt</code>) or to input
the data manually. Once the table is generated and filled, the
“Calculate parameters” button will calculate the total number of cells
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>),
total number of aberrations
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>),
as well as mean
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>y</mi><mo accent="true">‾</mo></mover><annotation encoding="application/x-tex">\bar{y}</annotation></semantics></math>),
variance
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>σ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\sigma^{2}</annotation></semantics></math>),
dispersion index
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mi>/</mi><mover><mi>y</mi><mo accent="true">‾</mo></mover></mrow><annotation encoding="application/x-tex">\sigma^{2}/\bar{y}</annotation></semantics></math>),
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>-value.</p>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-fit-01.png" alt="'Data input options' and 'Fitting options' boxes in the dose-effect fitting module" width="100%"><p class="caption">
‘Data input options’ and ‘Fitting options’ boxes in the dose-effect
fitting module
</p>
</div>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-fit-02.png" alt="'Data input' box in the dose-effect fitting module" width="75%"><p class="caption">
‘Data input’ box in the dose-effect fitting module
</p>
</div>
<p>This step is accomplished in R by calling the
<code><a href="../reference/calculate_aberr_table.html">calculate_aberr_table()</a></code> function:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"count-data-mayakannan-2018.csv"</span>, package <span class="op">=</span> <span class="st">"biodosetools"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/calculate_aberr_table.html">calculate_aberr_table</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"count"</span>, assessment_u <span class="op">=</span> <span class="fl">1.17</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 10 × 14</span></span></span>
<span><span class="co">#&gt;        D     N     X    C0    C1    C2    C3    C4    C5    C6   mean    var</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  0     <span style="text-decoration: underline;">7</span>500   174  <span style="text-decoration: underline;">7</span>326   174     0     0     0     0     0 0.023<span style="text-decoration: underline;">2</span> 0.022<span style="text-decoration: underline;">7</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  0.1   <span style="text-decoration: underline;">2</span>500    60  <span style="text-decoration: underline;">2</span>440    60     0     0     0     0     0 0.024  0.023<span style="text-decoration: underline;">4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  0.25  <span style="text-decoration: underline;">2</span>950    85  <span style="text-decoration: underline;">2</span>865    85     0     0     0     0     0 0.028<span style="text-decoration: underline;">8</span> 0.028<span style="text-decoration: underline;">0</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  0.5   <span style="text-decoration: underline;">3</span>000   111  <span style="text-decoration: underline;">2</span>889   111     0     0     0     0     0 0.037  0.035<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  1     <span style="text-decoration: underline;">1</span>610    74  <span style="text-decoration: underline;">1</span>542    63     4     1     0     0     0 0.046<span style="text-decoration: underline;">0</span> 0.052<span style="text-decoration: underline;">6</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  2     <span style="text-decoration: underline;">1</span>409   134  <span style="text-decoration: underline;">1</span>294   101    10     3     1     0     0 0.095<span style="text-decoration: underline;">1</span> 0.122 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  3     <span style="text-decoration: underline;">1</span>490   189  <span style="text-decoration: underline;">1</span>332   132    21     5     0     0     0 0.127  0.159 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  4     <span style="text-decoration: underline;">1</span>466   310  <span style="text-decoration: underline;">1</span>231   180    40    11     3     1     0 0.211  0.305 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  5     <span style="text-decoration: underline;">1</span>314   328  <span style="text-decoration: underline;">1</span>047   216    42     8     1     0     0 0.250  0.297 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  6     <span style="text-decoration: underline;">1</span>537   450  <span style="text-decoration: underline;">1</span>202   254    57    19     2     1     2 0.293  0.423 </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 2 more variables: DI &lt;dbl&gt;, u &lt;dbl&gt;</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="irradiation-conditions">Irradiation conditions<a class="anchor" aria-label="anchor" href="#irradiation-conditions"></a>
</h2>
<p>Because irradiation conditions during calibration may influence
future dose estimates, and for a better traceability, the user can input
the conditions under which the samples used to construct the curve were
irradiated. This option is only available in the Shiny app, so that
these can be saved into the generated reports.</p>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-fit-03.png" alt="'Irradiation conditions' box in the dose-effect fitting module" width="100%"><p class="caption">
‘Irradiation conditions’ box in the dose-effect fitting module
</p>
</div>
</div>
<div class="section level2">
<h2 id="perform-fitting">Perform fitting<a class="anchor" aria-label="anchor" href="#perform-fitting"></a>
</h2>
<p>To perform the fitting the user needs to select the appropriate
fitting options to click the “Calculate fitting” button on the “Data
input” box.</p>
<p>The fitting results and summary statistics are shown in the “Results”
tabbed box, and the dose-effect curve is displayed in the “Curve plot”
box.</p>
<p>The “Export results” box shows two buttons: (a) “Save fitting data”,
and (b) “Download report”. The “Save fitting data” will generate an
<code>.rds</code> file that contains all information about the count
data, irradiation conditions, and options selected when performing the
fitting. This file can be then loaded in the dose estimation module to
load the dose-effect curve coefficients.</p>
<p>Similarly, the “Download report” will generate a <code>.pdf</code> or
a <code>.docx</code> report containing all inputs and fitting
results.</p>
<div class="figure" style="text-align: center">
<img src="figures/screenshot-micronuclei-fit-04.png" alt="'Results' tabbed box, 'Curve plot' and 'Export results' boxes in the dose-effect fitting module" width="100%"><p class="caption">
‘Results’ tabbed box, ‘Curve plot’ and ‘Export results’ boxes in the
dose-effect fitting module
</p>
</div>
<p>To perform the fitting in R we call the <code><a href="../reference/fit.html">fit()</a></code>
function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit.html">fit</a></span><span class="op">(</span></span>
<span>  count_data <span class="op">=</span> <span class="va">count_data</span>,</span>
<span>  model_formula <span class="op">=</span> <span class="st">"lin-quad"</span>,</span>
<span>  model_family <span class="op">=</span> <span class="st">"quasipoisson"</span>,</span>
<span>  fit_link <span class="op">=</span> <span class="st">"identity"</span>,</span>
<span>  aberr_module <span class="op">=</span> <span class="st">"micronuclei"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>fit_results</code> object is a list that contains all
necessary information about the count data as well as options selected
when performing the fitting. This is a vital step to ensure traceability
and reproducibility. Below we can see its elements:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fit_results</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "fit_raw_data"         "fit_formula_raw"      "fit_formula_tex"     </span></span>
<span><span class="co">#&gt;  [4] "fit_coeffs"           "fit_cor_mat"          "fit_var_cov_mat"     </span></span>
<span><span class="co">#&gt;  [7] "fit_dispersion"       "fit_model_statistics" "fit_algorithm"       </span></span>
<span><span class="co">#&gt; [10] "fit_model_summary"</span></span></code></pre></div>
<p>In particular, we can see how <code>fit_coeffs</code> matches the
results obtained in the UI:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_results</span><span class="op">$</span><span class="va">fit_coeffs</span></span>
<span><span class="co">#&gt;                estimate    std.error statistic      p.value</span></span>
<span><span class="co">#&gt; coeff_C     0.022304968 0.0016412463 13.590263 2.747258e-06</span></span>
<span><span class="co">#&gt; coeff_alpha 0.027791344 0.0044014447  6.314141 3.987058e-04</span></span>
<span><span class="co">#&gt; coeff_beta  0.003332782 0.0009379284  3.553343 9.301982e-03</span></span></code></pre></div>
<p>To visualize the dose-effect curve, we call the
<code><a href="../reference/plot_fit_dose_curve.html">plot_fit_dose_curve()</a></code> function:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_fit_dose_curve.html">plot_fit_dose_curve</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_results</span>,</span>
<span>  aberr_name <span class="op">=</span> <span class="st">"Micronuclei"</span>,</span>
<span>  place <span class="op">=</span> <span class="st">"UI"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="micro-fitting_files/figure-html/micro-fit-dose-curve-1.png" alt="Plot of dose-effect curve generated by \{biodosetools\}. The grey shading indicates the uncertainties associated with the calibration curve." width="576"><p class="caption">
Plot of dose-effect curve generated by {biodosetools}. The grey shading
indicates the uncertainties associated with the calibration curve.
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://aldomann.com" class="external-link">Alfredo Hernández</a>, <a href="https://portalrecerca.uab.cat/es/persons/anna-frances-abellan" class="external-link">Anna Frances-Abellan</a>, David Endesfelder, Pere Puig.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
